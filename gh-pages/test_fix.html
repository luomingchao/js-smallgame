<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        #output {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0088ff;
        }
    </style>
</head>
<body>
    <h1>ğŸ® AIæŒ‡æŒ¥å®˜æ¸¸æˆä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>ğŸ”§ æ£€æŸ¥é¡¹ç›®</h3>
        <div id="checks"></div>
    </div>
    
    <div class="test-section">
        <h3>ğŸ§ª æ‰‹åŠ¨æµ‹è¯•</h3>
        <button onclick="testButtonClick()">æµ‹è¯•å¼€å§‹æ¸¸æˆæŒ‰é’®</button>
        <button onclick="testGameEngine()">æµ‹è¯•æ¸¸æˆå¼•æ“åˆå§‹åŒ–</button>
        <button onclick="checkEventListeners()">æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨</button>
        <button onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“Š æµ‹è¯•è¾“å‡º</h3>
        <div id="output"></div>
    </div>

    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : 
                          type === 'success' ? 'âœ…' : 
                          type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            output.innerHTML += `${timestamp} ${prefix} ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            output.innerHTML = '';
        }
        
        function checkAll() {
            clearOutput();
            log('å¼€å§‹æ£€æŸ¥ä¿®å¤é¡¹ç›®...');
            
            // æ£€æŸ¥DOMå…ƒç´ 
            const elements = [
                'gameCanvas', 'startGame', 'pauseGame', 'resetGame', 
                'money', 'energy', 'rulesModal'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`æ‰¾åˆ°å…ƒç´ : ${id}`, 'success');
                } else {
                    log(`ç¼ºå°‘å…ƒç´ : ${id}`, 'error');
                }
            });
            
            // æ£€æŸ¥å…¨å±€å¯¹è±¡
            log('æ£€æŸ¥ window.gameEngine:', 'info');
            if (window.gameEngine) {
                log('âœ… window.gameEngine å·²å­˜åœ¨', 'success');
                log(`æ¸¸æˆçŠ¶æ€: ${window.gameEngine.gameState}`);
                log(`å½“å‰å…³å¡: ${window.gameEngine.level}`);
                log(`æ–°æ‰‹æ¨¡å¼: ${window.gameEngine.newbieMode}`);
            } else {
                log('âŒ window.gameEngine ä¸å­˜åœ¨', 'error');
            }
            
            // æ£€æŸ¥UIç®¡ç†å™¨
            log('æ£€æŸ¥ window.uiManager:', 'info');
            if (window.uiManager) {
                log('âœ… window.uiManager å·²å­˜åœ¨', 'success');
            } else {
                log('âš ï¸ window.uiManager ä¸å­˜åœ¨ï¼ˆå¯èƒ½æ­£å¸¸ï¼Œå–å†³äºåˆå§‹åŒ–é¡ºåºï¼‰', 'warning');
            }
            
            // æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
            const startBtn = document.getElementById('startGame');
            if (startBtn) {
                const events = getEventListeners(startBtn);
                if (events.click && events.click.length > 0) {
                    log('âœ… å¼€å§‹æŒ‰é’®æœ‰ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨', 'success');
                    events.click.forEach(listener => {
                        log(`ç›‘å¬å™¨: ${listener.listener.name || 'åŒ¿åå‡½æ•°'}`);
                    });
                } else {
                    log('âŒ å¼€å§‹æŒ‰é’®æ²¡æœ‰ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨', 'error');
                }
            }
            
            log('æ£€æŸ¥å®Œæˆï¼');
        }
        
        function testButtonClick() {
            clearOutput();
            log('æµ‹è¯•å¼€å§‹æ¸¸æˆæŒ‰é’®...');
            
            const startBtn = document.getElementById('startGame');
            if (startBtn) {
                log('æ‰¾åˆ°å¼€å§‹æŒ‰é’®ï¼Œå¼€å§‹æµ‹è¯•ç‚¹å‡»...', 'success');
                // æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»
                const clickEvent = new MouseEvent('click', {
                    bubbles: true,
                    cancelable: true
                });
                startBtn.dispatchEvent(clickEvent);
                log('ç‚¹å‡»äº‹ä»¶å·²å‘é€');
            } else {
                log('âŒ æ‰¾ä¸åˆ°å¼€å§‹æŒ‰é’®', 'error');
            }
        }
        
        function testGameEngine() {
            clearOutput();
            log('æµ‹è¯•æ¸¸æˆå¼•æ“...');
            
            try {
                if (window.gameEngine) {
                    log('æ¸¸æˆå¼•æ“å·²å­˜åœ¨ï¼Œæµ‹è¯•startGameæ–¹æ³•...', 'success');
                    window.gameEngine.startGame();
                    log('startGameæ–¹æ³•æ‰§è¡Œå®Œæˆ', 'success');
                } else {
                    log('âŒ æ¸¸æˆå¼•æ“ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                log(`âŒ æ¸¸æˆå¼•æ“æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
                console.error('æ¸¸æˆå¼•æ“æµ‹è¯•é”™è¯¯:', error);
            }
        }
        
        function checkEventListeners() {
            clearOutput();
            log('æ£€æŸ¥æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨...');
            
            const buttonIds = ['startGame', 'pauseGame', 'resetGame'];
            
            buttonIds.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    const events = getEventListeners(btn);
                    log(`${id} æŒ‰é’®çš„äº‹ä»¶:`, 'info');
                    if (events.click && events.click.length > 0) {
                        events.click.forEach(listener => {
                            log(`  - click: ${listener.listener.toString().substring(0, 100)}...`, 'success');
                        });
                    } else {
                        log(`  - æ²¡æœ‰ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨`, 'warning');
                    }
                } else {
                    log(`${id} æŒ‰é’®ä¸å­˜åœ¨`, 'error');
                }
            });
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œæ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkAll, 1000);
        });
        
        // æ·»åŠ è·å–äº‹ä»¶ç›‘å¬å™¨çš„å‡½æ•°ï¼ˆæµè§ˆå™¨è°ƒè¯•å·¥å…·ï¼‰
        if (!window.getEventListeners) {
            window.getEventListeners = function(element) {
                const listeners = {};
                for (let eventType in element._eventListeners) {
                    listeners[eventType] = element._eventListeners[eventType];
                }
                return listeners;
            };
        }
    </script>
</body>
</html>