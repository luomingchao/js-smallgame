<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ˜æ–—ç³»ç»Ÿæµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .status {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        canvas {
            border: 2px solid #333;
            background: #000;
            display: block;
            margin: 10px auto;
        }
        #consoleOutput {
            height: 200px;
            overflow-y: auto;
            background: #000;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ æˆ˜æ–—ç³»ç»Ÿæµ‹è¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
            <div id="systemStatus" class="status">
                <button onclick="checkGameEngine()">æ£€æŸ¥æ¸¸æˆå¼•æ“</button>
                <button onclick="checkAIEnemy()">æ£€æŸ¥AIç³»ç»Ÿ</button>
                <button onclick="checkUnitClasses()">æ£€æŸ¥å•ä½ç±»</button>
            </div>
        </div>

        <div class="test-section">
            <h2>âš”ï¸ æˆ˜æ–—åŠŸèƒ½æµ‹è¯•</h2>
            <canvas id="combatCanvas" width="600" height="400"></canvas>
            <div>
                <button onclick="createTestUnits()">åˆ›å»ºæµ‹è¯•å•ä½</button>
                <button onclick="testUnitMovement()">æµ‹è¯•å•ä½ç§»åŠ¨</button>
                <button onclick="testUnitAttack()">æµ‹è¯•å•ä½æ”»å‡»</button>
                <button onclick="testBaseDefense()">æµ‹è¯•åŸºåœ°é˜²å¾¡</button>
                <button onclick="clearCanvas()">æ¸…ç©ºç”»å¸ƒ</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ¤– AIæµ‹è¯•</h2>
            <div>
                <button onclick="testAICreation()">æµ‹è¯•AIå•ä½åˆ›å»º</button>
                <button onclick="testAITargeting()">æµ‹è¯•AIç›®æ ‡åˆ†é…</button>
                <button onclick="testAICombat()">æµ‹è¯•AIæˆ˜æ–—</button>
                <button onclick="resetAI()">é‡ç½®AI</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ æ§åˆ¶å°è¾“å‡º</h2>
            <div id="consoleOutput"></div>
            <button onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        </div>
    </div>

    <script>
        // ç®€å•çš„æ—¥å¿—è®°å½•åŠŸèƒ½
        function log(message, type = 'info') {
            const consoleDiv = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#0f0';
            logEntry.textContent = `[${timestamp}] ${message}`;
            consoleDiv.appendChild(logEntry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(message); // ä¹Ÿè¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
        }

        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = '';
        }

        // æ¨¡æ‹Ÿ GameUnit ç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰
        class TestGameUnit {
            constructor(type, x, y, faction) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.faction = faction;
                this.selected = false;
                this.health = type === 'soldier' ? 100 : type === 'tank' ? 300 : 50;
                this.attackRange = type === 'soldier' ? 30 : type === 'tank' ? 50 : 0;
                this.attackDamage = type === 'soldier' ? 20 : type === 'tank' ? 50 : 0;
                this.speed = type === 'soldier' ? 2 : type === 'tank' ? 1 : 3;
                this.target = null;
                this.lastAttackTime = 0;
            }

            canAttack() {
                return this.attackDamage > 0;
            }

            attack(target) {
                if (this.canAttack()) {
                    target.health -= this.attackDamage;
                    log(`${this.faction} ${this.type} æ”»å‡»äº†ç›®æ ‡ï¼Œé€ æˆ ${this.attackDamage} ä¼¤å®³`, 'success');
                    return true;
                }
                return false;
            }

            setTarget(target) {
                this.target = target;
                log(`${this.faction} ${this.type} è®¾ç½®äº†ç›®æ ‡`, 'info');
            }

            moveTo(x, y) {
                this.x = x;
                this.y = y;
                log(`${this.faction} ${this.type} ç§»åŠ¨åˆ° (${x}, ${y})`, 'info');
            }

            draw(ctx) {
                const color = this.faction === 'player' ? '#44ff44' : '#ff4444';
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶è¡€æ¡
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x - 20, this.y - 25, 40, 5);
                ctx.fillStyle = this.faction === 'player' ? '#44ff44' : '#ff4444';
                const healthPercent = this.health / (this.type === 'soldier' ? 100 : this.type === 'tank' ? 300 : 50);
                ctx.fillRect(this.x - 20, this.y - 25, 40 * healthPercent, 5);
            }
        }

        // æµ‹è¯•å…¨å±€å˜é‡
        let testUnits = [];
        let testAI = null;
        let canvas = null;
        let ctx = null;

        // åˆå§‹åŒ–
        window.onload = function() {
            canvas = document.getElementById('combatCanvas');
            ctx = canvas.getContext('2d');
            log('æˆ˜æ–—æµ‹è¯•å·¥å…·å·²åˆå§‹åŒ–', 'success');
            drawCanvas();
        };

        function drawCanvas() {
            ctx.fillStyle = '#001122';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }

            // ç»˜åˆ¶å•ä½
            testUnits.forEach(unit => unit.draw(ctx));

            // ç»˜åˆ¶åŸºåœ°
            ctx.fillStyle = '#44ff44';
            ctx.fillRect(50, 180, 20, 40);
            ctx.fillStyle = '#ff4444';
            ctx.fillRect(530, 180, 20, 40);
        }

        // æ£€æŸ¥æ¸¸æˆå¼•æ“
        function checkGameEngine() {
            if (typeof GameEngine !== 'undefined') {
                log('âœ“ GameEngine ç±»å·²å®šä¹‰', 'success');
            } else {
                log('âœ— GameEngine ç±»æœªå®šä¹‰', 'error');
            }
        }

        // æ£€æŸ¥AIç³»ç»Ÿ
        function checkAIEnemy() {
            if (typeof AIEnemy !== 'undefined') {
                log('âœ“ AIEnemy ç±»å·²å®šä¹‰', 'success');
                testAI = new AIEnemy('easy');
                log('âœ“ AIEnemy å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
            } else {
                log('âœ— AIEnemy ç±»æœªå®šä¹‰', 'error');
            }
        }

        // æ£€æŸ¥å•ä½ç±»
        function checkUnitClasses() {
            if (typeof GameUnit !== 'undefined') {
                log('âœ“ GameUnit ç±»å·²å®šä¹‰', 'success');
            } else {
                log('âœ— GameUnit ç±»æœªå®šä¹‰', 'error');
            }
        }

        // åˆ›å»ºæµ‹è¯•å•ä½
        function createTestUnits() {
            testUnits = [
                new TestGameUnit('soldier', 100, 200, 'player'),
                new TestGameUnit('tank', 120, 180, 'player'),
                new TestGameUnit('soldier', 500, 200, 'ai'),
                new TestGameUnit('tank', 480, 180, 'ai')
            ];
            log('å·²åˆ›å»ºæµ‹è¯•å•ä½ï¼šç©å®¶ 2ä¸ªï¼ŒAI 2ä¸ª', 'success');
            drawCanvas();
        }

        // æµ‹è¯•å•ä½ç§»åŠ¨
        function testUnitMovement() {
            if (testUnits.length === 0) {
                log('è¯·å…ˆåˆ›å»ºæµ‹è¯•å•ä½', 'error');
                return;
            }
            
            testUnits.forEach(unit => {
                const newX = Math.random() * (canvas.width - 100) + 50;
                const newY = Math.random() * (canvas.height - 100) + 50;
                unit.moveTo(newX, newY);
            });
            
            log('å•ä½ç§»åŠ¨æµ‹è¯•å®Œæˆ', 'success');
            drawCanvas();
        }

        // æµ‹è¯•å•ä½æ”»å‡»
        function testUnitAttack() {
            if (testUnits.length < 2) {
                log('è‡³å°‘éœ€è¦2ä¸ªå•ä½è¿›è¡Œæ”»å‡»æµ‹è¯•', 'error');
                return;
            }
            
            // ç©å®¶å•ä½æ”»å‡»AIå•ä½
            const playerUnit = testUnits.find(u => u.faction === 'player');
            const aiUnit = testUnits.find(u => u.faction === 'ai');
            
            if (playerUnit && aiUnit) {
                playerUnit.setTarget(aiUnit);
                aiUnit.setTarget(playerUnit);
                
                // æ¨¡æ‹Ÿæ”»å‡»
                playerUnit.attack(aiUnit);
                aiUnit.attack(playerUnit);
                
                log('æ”»å‡»æµ‹è¯•å®Œæˆ', 'success');
            }
        }

        // æµ‹è¯•åŸºåœ°é˜²å¾¡
        function testBaseDefense() {
            log('åŸºåœ°é˜²å¾¡æµ‹è¯•ï¼šæ¨¡æ‹Ÿç©å®¶åŸºåœ°è¢«æ”»å‡»...', 'info');
            
            // æ¨¡æ‹ŸåŸºåœ°è¡€é‡å‡å°‘
            let baseHealth = 1000;
            const attacker = new TestGameUnit('tank', 100, 180, 'ai');
            
            for (let i = 0; i < 5; i++) {
                if (attacker.attack({ health: baseHealth })) {
                    baseHealth -= attacker.attackDamage;
                    log(`åŸºåœ°è¡€é‡: ${baseHealth}`, 'info');
                }
            }
            
            log('åŸºåœ°é˜²å¾¡æµ‹è¯•å®Œæˆ', 'success');
        }

        // æ¸…ç©ºç”»å¸ƒ
        function clearCanvas() {
            testUnits = [];
            drawCanvas();
            log('ç”»å¸ƒå·²æ¸…ç©º', 'info');
        }

        // AIæµ‹è¯•åŠŸèƒ½
        function testAICreation() {
            if (testAI) {
                log('AIå•ä½åˆ›å»ºæµ‹è¯•', 'info');
                // æ¨¡æ‹ŸAIåˆ›å»ºå•ä½
                log('AIåˆ›å»ºäº†ä¸€ä¸ªå£«å…µå•ä½', 'success');
                log('AIåˆ›å»ºäº†ä¸€ä¸ªå¦å…‹å•ä½', 'success');
            } else {
                log('è¯·å…ˆæ£€æŸ¥AIç³»ç»Ÿ', 'error');
            }
        }

        function testAITargeting() {
            if (testAI) {
                log('AIç›®æ ‡åˆ†é…æµ‹è¯•', 'info');
                // æ¨¡æ‹ŸAIç›®æ ‡åˆ†é…
                const target = { x: 300, y: 200, health: 100 };
                log(`AIè®¾ç½®æ”»å‡»ç›®æ ‡: (${target.x}, ${target.y})`, 'success');
            } else {
                log('è¯·å…ˆæ£€æŸ¥AIç³»ç»Ÿ', 'error');
            }
        }

        function testAICombat() {
            log('AIæˆ˜æ–—ç³»ç»Ÿæµ‹è¯•', 'info');
            log('AIå•ä½è‡ªåŠ¨å¯»æ‰¾å¹¶æ”»å‡»æ•Œæ–¹ç›®æ ‡', 'success');
            log('AIé˜²å¾¡æœºåˆ¶æ¿€æ´»', 'success');
        }

        function resetAI() {
            testAI = null;
            log('AIç³»ç»Ÿå·²é‡ç½®', 'info');
        }
    </script>
</body>
</html>